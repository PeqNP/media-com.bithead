<div class="ui-application">
  <script type="text/application">
    function $(this.id)(config) {
      let project;

      function close() {
        os.closeApplication('$(app.bundleId)');
      }
      this.close = close;

      async function createProject() {
        // TODO: Make calls to server to create project
        let win = await $(this.controller).loadController("Editor");
        win.ui.show(function (ctrl) {
          // TODO: Configure controller with project
        });
      }
      this.createProject = createProject;

      /**
       * Add a new window, modal, or embedded controller to the project.
       */
      async function createController() {
        let win = await $(this.controller).loadController("ControllerSelector");
        win.ui.show();
      }
      this.createController = createController;

      /**
       * Show menu with list of projects that can be opened.
       */
      async function openProject() {
        let win = await $(this.controller).loadController("Projects");
        win.ui.show();
      }
      this.openProject = openProject;

      /**
       * Close the focused project.
       */
      function closeProject() {
        // TODO: Close the focused project
      }

      /**
       * Save the focused project.
       */
      function saveProject() {
        // TODO: Savew the focused project
      }

      /**
       * Import a project from an uploaded zip.
       */
      async function importProject() {
        // TODO: Import project
        let win = await $(this.controller).loadController("ImportProject");
        win.ui.show();
        // TODO: Show progress bar of import
        // TODO: Load imported project
      }
      this.importProject = importProject;

      /**
       * Focus on project.
       *
       * This is called by the Editor for an open project.
       *
       * @param {Project} project - Project Editor that gained focus
       */
      function didFocusProject(_project) {
        project = _project;

        let menus = $(this.controller).menus();
        let menu = menus.ui.select("file-menu");

        if (isEmpty(project)) {
          menu.ui.disableOption("Add controller");
          menu.ui.disableOption("Close project");
          menu.ui.disableOption("Save project");
        }
        else {
          menu.ui.enableOption("Add controller");
          menu.ui.enableOption("Close project");
          menu.ui.enableOption("Save project");
        }
      }
      this.didFocusProject = didFocusProject;
    }
  </script>
  <div class="ui-menus">
    <div class="ui-menu" style="width: 180px">
      <select name="boss-code-menu">
        <option>BOSSCode</option>
        <option onclick="$(this.controller).close();">Close BOSSCode</option>
      </select>
    </div>
    <div class="ui-menu" style="width: 180px">
      <select name="file-menu">
        <option>File</option>
        <option onclick="$(this.controller).createProject();">New project</option>
        <option onclick="$(this.controller).openProject();">Open project</option>
        <option onclick="$(this.controller).importProject();">Import project</option>
        <option class="group"></option>
        <option onclick="$(this.controller).createController();" disabled>Add controller</option>
        <option onclick="$(this.controller).createController();" disabled>Add file</option>
        <option onclick="$(this.controller).createController();" disabled>Add folder</option>
        <option onclick="$(this.controller).createController();" disabled>Upload file</option>
        <option class="group"></option>
        <option onclick="$(this.controller).closeProject();" disabled>Close project</option>
        <option onclick="$(this.controller).closeProject();" disabled>Save project</option>
      </select>
    </div>
  </div>
</div>
